<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<div class="w-75 mx-auto border border-3 rounded p-4 mb-5"  >
	<div class="col-12 ">
		<label class="btn btn-outline-primary w-100"> 
		<input
			type="file" name="upfile[]" id="upfile" multiple=""
			class="upfile d-none" accept=".jpg, .jpeg, .png,"> 上傳檔案
		</label>
		<ul style="list-style-type: disc;">
			<li>請上傳身分證正反面、及第二證件照片</li>
			<li>每張照片容量最高 1M</li>
			<li>照片寬度最小 1000px</li>
			<li>檔案類型必須是 jpg、png</li>
			<li>按下【確定送出】才完成上傳</li>
		</ul>

		<div id="img_errmsg" class="text-danger text-center tw-bold"></div>
		<div id="img_area" class="text-center">
			
		</div>
	</div>
</div>
<script>
let issubmit = true;
let imgErrMsgArea = $('#img_errmsg');
let imgPreArea = $('#img_area');
let maxSize = 1024 * 1024;
let minWidth = 1000;


$('#upfile').on('change', function () {
  issubmit = true;
  imgErrMsgArea.text('');
  imgPreArea.html('');

  let filesLength =  this.files.length;
  console.log(filesLength);
  if(filesLength > 10){ 
    alert("不合"); 
  }

  $(this.files).each(function (i, obj) {
  
    let reader = new FileReader();
    reader.onload = function (e) {
      let data = e.target.result;
      
      imgPreArea.append('<img src="' + data + '" height="100" class="p-1">');

     
      let fileSize = obj['size'];
      if (fileSize > maxSize) {
        issubmit = false;
        imgErrMsgArea.append('<br>' + obj['name'] + '瑼娍��捆��誩云憭�');
      }

      
      let image = new Image();
      image.onload = function () {
        let upfileWidth = image.width;
        if (upfileWidth < minWidth) {
          issubmit = false;
          imgErrMsgArea.append('<br>' + obj['name'] + '瑼娍��祝摨血云撠�');
        }
      }
      image.src = data;
    }
    reader.readAsDataURL(obj);
    
  }); //each end
}); //on change end

$('#apply_form').on('submit', function () {
  if (!issubmit) {
    return false;
  } else {

    let chLangNum = 0;
    $('.ch-lang').each(function (i, obj) {
      if ($(obj).is(':checked')) { chLangNum++; }
    });
    if (chLangNum > 0) {
      issubmit2 = true;
      if (!ch_lang_msg.hasClass('d-none')) {
        ch_lang_msg.addClass('d-none');
      }
    } else {
      issubmit2 = false;
      ch_lang_msg.removeClass('d-none');
    }

    if (issubmit2) {
      return true;
    } else {
      return false;
    }
  }
});
</script>